!function o(i,r,s){function c(n,t){if(!r[n]){if(!i[n]){var e="function"==typeof require&&require;if(!t&&e)return e(n,!0);if(l)return l(n,!0);throw new Error("Cannot find module '"+n+"'")}e=r[n]={exports:{}};i[n][0].call(e.exports,function(t){var e=i[n][1][t];return c(e||t)},e,e.exports,o,i,r,s)}return r[n].exports}for(var l="function"==typeof require&&require,t=0;t<s.length;t++)c(s[t]);return c}({1:[function(t,e,n){"use strict";n.__esModule=!0,n.EGameResult=void 0;var o,i=t("../pubsub/pubsub");(t=o=n.EGameResult||(n.EGameResult={})).Victory="victory",t.Reset="reset",t.Continue="continue";r.prototype.getResult=function(t,n){var e=new Set(t.map(function(t){t=t.coordinate.get();return t.x+","+t.y}));return e.size<t.length||new Set(n.map(function(t){t=t.coordinate.get();return t.x+","+t.y})).size<t.length?o.Reset:t.every(function(t,e){return t.fit(n[e])})?o.Victory:o.Continue},r.prototype.addListener=function(t,e){this.pubsub.subscribe(t,e)},r.prototype.removeListener=function(t,e){this.pubsub.unscribe(t,e)},t=r;function r(t){this.isCustomize=!1,this.renderer=null,t?this.renderer=t:this.isCustomize=!0,this.pubsub=new i.default}n.default=t},{"../pubsub/pubsub":3}],2:[function(t,e,n){"use strict";var o,i=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});n.__esModule=!0;var r,s=t("./game"),a=t("../units/mover"),c=t("../units/controller"),l=t("../units/panel"),u=t("../units/obstacle"),h=t("../units/direction"),f=t("../units/pedometer"),d=t("../units/timer"),i=(r=s.default,i(p,r),p.prototype.render=function(){!this.isCustomize&&this.renderer&&this.renderer.render({controller:this.controller,isSuccess:this.isSuccess,cells:this.panel.cells,count:this.pedometer.get(),time:this.timer.displayByS(),movers:this.movers.map(function(t){return{coordinate:t.coordinate.get(),alias:t.alias,locked:t.locked}}),lockedMovers:this.lockedMovers.map(function(t){return{coordinate:t.coordinate.get(),alias:t.alias,locked:t.locked}})})},p.prototype.start=function(){var t=this;this.timer.start();var e=this;this.controller.on(h.default.Up,function(){return e.onMove(0,-1,t.onMoveEnd.bind(t))}),this.controller.on(h.default.Down,function(){return e.onMove(0,1,t.onMoveEnd.bind(t))}),this.controller.on(h.default.Left,function(){return e.onMove(-1,0,t.onMoveEnd.bind(t))}),this.controller.on(h.default.Right,function(){return e.onMove(1,0,t.onMoveEnd.bind(t))}),window.onresize=function(){return t.render()}},p.prototype.stop=function(){this.timer.close()},p.prototype.onTimeChange=function(){this.render()},p.prototype.onMove=function(t,e,n){for(var o=!1,i=0;i<this.movers.length;i++){var r=this.movers[i].coordinate.get(),s={x:r.x+t,y:r.y+e},r=null===(r=this.panel.get(s.x,s.y))||void 0===r?void 0:r.obstacle;r&&this.movers[i].move(s,r)&&(o=!0)}o&&this.pedometer.record(),this.render(),n&&n()},p.prototype.onMoveEnd=function(){switch(this.getResult(this.movers,this.lockedMovers)){case s.EGameResult.Victory:this.onGameOver();break;case s.EGameResult.Reset:this.onGameReset();break;case s.EGameResult.Continue:}},p.prototype.onGameReset=function(){var n=this;console.log("移动物体重置"),this.movers.forEach(function(t,e){n.movers[e].reset()})},p.prototype.onGameOver=function(){console.log("Congratulations!!! Your score is "+this.timer.displayByS()+"S"),this.isSuccess=!0,this.render(),this.stop()},p.prototype.initPairedMovers=function(t){for(var e,n,o,i=this.panel.cells.filter(function(t){return t.obstacle.type===u.EObstacleType.Null}),r=i.length,s=[-1,-1],c=s[0],l=s[1];c===l||!this.panel.reachable(c,l);)c=(e=[Math.random()*r|0,Math.random()*r|0])[0],l=e[1];return i[c]&&(n=new a.default(i[c].coordinate.copy(),t)),i[l]&&(o=new a.default(i[l].coordinate.copy(),t)).lock(),[n,o]},p.prototype.generateMovers=function(){for(var t,e=new Set,n=0;n<p.NUM_OF_MOVER;n++){for(var o=[void 0,void 0],i=o[0],r=o[1],o=[void 0,void 0],s=o[0],c=o[1];!s||!c||e.has(s)||e.has(c);)i=(t=this.initPairedMovers(p.ALIAS_OF_MOVER[n]))[0],r=t[1],s=(t=[i.coordinate.get(),r.coordinate.get()])[0],c=t[1];this.movers[n]=i,this.lockedMovers[n]=r,e.add(s),e.add(c)}},p.NUM_OF_MOVER=3,p.ALIAS_OF_MOVER=["red","blue","yellow"],p);function p(t){t=r.call(this,t)||this;return t.movers=[],t.lockedMovers=[],t.isSuccess=!1,t.panel=new l.default,t.controller=new c.default,t.pedometer=new f.default,t.timer=new d.default(t.onTimeChange.bind(t)),t.generateMovers(),t.render(),t.start(),t}n.default=i},{"../units/controller":5,"../units/direction":7,"../units/mover":8,"../units/obstacle":9,"../units/panel":10,"../units/pedometer":11,"../units/timer":12,"./game":1}],3:[function(t,e,n){"use strict";n.__esModule=!0;var o=(i.prototype.subscribe=function(t,e){Object.prototype.hasOwnProperty.call(this.subscribers,t)||(this.subscribers[t]=[]),this.subscribers[t].push(e)},i.prototype.unscribe=function(t,e){var n=this.subscribers[t];n&&n.length&&(this.subscribers[t]=n.filter(function(t){return t!==e}))},i.prototype.publish=function(t,e){t=this.subscribers[t];t&&t.length&&t.forEach(function(t){return t(e)})},i);function i(){this.subscribers={}}n.default=o},{}],4:[function(t,e,n){"use strict";n.__esModule=!0,n.default=function(t,e){this.obstacle=t,this.coordinate=e}},{}],5:[function(t,e,n){"use strict";n.__esModule=!0;var o=t("../pubsub/pubsub"),t=(i.prototype.on=function(t,e){this.pubsub.subscribe(t,e)},i.prototype.trigger=function(t){this.pubsub.publish(t,{})},i);function i(){this.pubsub=new o.default}n.default=t},{"../pubsub/pubsub":3}],6:[function(t,e,n){"use strict";n.__esModule=!0;var o=(i.prototype.set=function(t,e){this.x=t,this.y=e},i.prototype.get=function(){return{x:this.x,y:this.y}},i.prototype.copy=function(){return new i(this.x,this.y)},i.random=function(t,e,n,o){if(n<t||o<e)throw new Error("x1 must be greater tnen x0 and y0 must be greater then y1 too!");return{x:Math.random()*(n-t-1)+t|0,y:Math.random()*(o-e-1)+e|0}},i);function i(t,e){this.x=t,this.y=e}n.default=o},{}],7:[function(t,e,n){"use strict";var o,i;n.__esModule=!0,(i=o=o||{}).Up="up",i.Down="down",i.Left="left",i.Right="right",n.default=o},{}],8:[function(t,e,n){"use strict";n.__esModule=!0;var o=t("./obstacle"),t=(i.prototype.isSameAlias=function(t){return this.alias&&t.alias&&this.alias===t.alias},i.prototype.isSameCoordinate=function(t){var e=this.coordinate.get(),n=e.x,o=e.y,e=t.coordinate.get(),t=e.x,e=e.y;return n===t&&o===e},i.prototype.reset=function(){this.coordinate.set(this.initialCoordinate.x,this.initialCoordinate.y)},i.prototype.fit=function(t){return this.isSameCoordinate(t)&&this.isSameAlias(t)},i.prototype.move=function(t,e){return!(this.locked||!e)&&(e.type!==o.EObstacleType.Stake&&(e.type!==o.EObstacleType.Freeze&&(this.coordinate.set(t.x,t.y),!0)))},i.prototype.lock=function(t){var e=this;this.locked=!0,void 0!==t&&setTimeout(function(){e.unlock()},t)},i.prototype.unlock=function(){this.locked=!1},i);function i(t,e){this.locked=!1,this.coordinate=t,this.initialCoordinate=t.get(),this.alias=e}n.default=t},{"./obstacle":9}],9:[function(t,e,n){"use strict";var o;n.__esModule=!0,n.EObstacleType=void 0,(i=o=n.EObstacleType||(n.EObstacleType={}))[i.Null=0]="Null",i[i.Stake=1]="Stake",i[i.Freeze=2]="Freeze";var i=(r.randomType=function(t){t=1<(t=void 0===t?.3:t)?1:t<0?0:t;var e=Math.random();return e<t/2||e<t?o.Stake:o.Null},r);function r(t){this.type=t}n.default=i},{}],10:[function(t,e,n){"use strict";n.__esModule=!0;var o=t("./obstacle"),i=t("./coordinate"),r=t("./cell"),t=(s.prototype.init=function(){for(var t=0;t<this.size;t++)for(var e=0;e<this.size;e++)this.cells.push(new r.default(new o.default(o.default.randomType()),new i.default(t,e)))},s.prototype.reachable=function(t,e){return!0},s.prototype.get=function(n,o){return this.cells.find(function(t){var e=t.coordinate.get(),t=e.x,e=e.y;return t===n&&e===o})},s.INIT_SIZE=30,s);function s(t){this.size=s.INIT_SIZE,this.cells=[],t&&(this.size=t),this.init()}n.default=t},{"./cell":4,"./coordinate":6,"./obstacle":9}],11:[function(t,e,n){"use strict";n.__esModule=!0;var o=(i.prototype.record=function(){this.count++},i.prototype.get=function(){return this.count},i);function i(){this.count=0}n.default=o},{}],12:[function(t,e,n){"use strict";n.__esModule=!0;var o=(i.prototype.start=function(){this.create()},i.prototype.pause=function(){this.pending=!0},i.prototype.continue=function(){this.pending=!1,this.start()},i.prototype.close=function(){this.pending=!1,this.clear(),this.time=0},i.prototype.reset=function(){this.clear(),this.time=0,this.pending=!1,this.start()},i.prototype.create=function(){var t=this;this.timer=setTimeout(function(){t.clear(),t.pending||(t.time++,t.onChange(),t.create())},i.DELTA_TIME)},i.prototype.clear=function(){this.timer&&clearTimeout(this.timer)},i.prototype.display=function(){var t=this.time;return{h:t/3600|0,s:t%60,m:t%3600/60|0}},i.prototype.dispalyByMS=function(){return 1e3*this.time},i.prototype.displayByS=function(){return this.time},i.DELTA_TIME=1e3,i);function i(t){this.pending=!1,this.time=0,this.onChange=function(){return 0},t&&(this.onChange=t)}n.default=o},{}],13:[function(t,e,n){"use strict";n.__esModule=!0;n=t("./core/game/game_single_player"),t=t("./render/renderer");new n.default(new t.default("canvas-container"))},{"./core/game/game_single_player":2,"./render/renderer":21}],14:[function(t,e,n){"use strict";n.__esModule=!0;var o=(i.prototype.getEventPosition=function(t){var e=this.ele.getBoundingClientRect();return{x:t.clientX-e.left*(this.ele.width/e.width),y:t.clientY-e.top*(this.ele.height/e.height)}},i.prototype.on=function(t,n){var o=this;return i.handlers[++i.handlerId]=function(t){var e=o.getEventPosition(t);e.x>=o.x0&&e.x<=o.x1&&e.y>=o.y0&&e.y<=o.y1&&"function"==typeof n&&n(t)},this.ele.addEventListener(t,i.handlers[i.handlerId]),i.handlerId},i.prototype.remove=function(t,e){i.handlers[e]&&(console.log("clear"),this.ele.removeEventListener(t,i.handlers[e]))},i.handlers=[],i.handlerId=-1,i);function i(t,e,n,o,i){this.ele=t,this.x0=e,this.y0=n,this.x1=o,this.y1=i}n.default=o},{}],15:[function(t,e,n){"use strict";n.__esModule=!0;var v=t("./listener"),b=t("../core/units/direction"),t=(o.prototype.render=function(t,e){var n,o,i,r,s,c,l,a,u,h,f,d,p,y,x=this;this.context&&(d=(f=e.controller).x,p=f.y,n=f.w,o=f.h,i=t.controller,r=(y=[{x:d+n/3,y:p},{x:d+2*n/3,y:p},{x:d+2*n/3,y:p+o/3},{x:d+n,y:p+o/3},{x:d+n,y:p+2*o/3},{x:d+2*n/3,y:p+2*o/3},{x:d+2*n/3,y:p+o},{x:d+n/3,y:p+o},{x:d+n/3,y:p+2*o/3},{x:d,y:p+2*o/3},{x:d,y:p+o/3},{x:d+n/3,y:p+o/3}])[0],s=y[1],c=y[2],l=y[3],a=y[4],u=y[5],h=y[6],e=y[7],f=y[8],d=y[9],p=y[10],y=y[11],this.context.strokeStyle="#898",this.context.beginPath(),this.context.moveTo(r.x,r.y),this.context.lineTo(s.x,s.y),this.context.lineTo(c.x,c.y),this.context.lineTo(l.x,l.y),this.context.lineTo(a.x,a.y),this.context.lineTo(u.x,u.y),this.context.lineTo(h.x,h.y),this.context.lineTo(e.x,e.y),this.context.lineTo(f.x,f.y),this.context.lineTo(d.x,d.y),this.context.lineTo(p.x,p.y),this.context.lineTo(y.x,y.y),this.context.lineTo(r.x,r.y),this.context.closePath(),this.context.stroke(),this.context.fillStyle="#898",this.context.fillRect(r.x,r.y,n/3,o/3),this.context.fillRect(c.x,c.y,n/3,o/3),this.context.fillRect(f.x,f.y,n/3,o/3),this.context.fillRect(p.x,p.y,n/3,o/3),this.context.font="20px Georgia",this.context.fillStyle="#fff",this.context.fillText("上",y.x+15,y.y-20),this.context.fillText("右",u.x+15,u.y-20),this.context.fillText("下",e.x+15,e.y-20),this.context.fillText("左",d.x+15,d.y-20),0!==Object.keys(this.listeners).length||t.isSuccess||(this.listeners[b.default.Up]=new v.default(this.context.canvas,r.x,r.y,c.x,c.y),this.listeners[b.default.Right]=new v.default(this.context.canvas,c.x,c.y,a.x,a.y),this.listeners[b.default.Down]=new v.default(this.context.canvas,f.x,f.y,h.x,h.y),this.listeners[b.default.Left]=new v.default(this.context.canvas,p.x,p.y,f.x,f.y),Object.keys(this.listeners).forEach(function(t){x.eventIds[t]=(x.eventIds[t]||[]).concat(x.listeners[t].on("click",function(){i.trigger(t)}))})),t.isSuccess&&this.clear())},o.prototype.clear=function(){var n=this;Object.keys(this.eventIds).forEach(function(e){n.eventIds[e].forEach(function(t){n.listeners[e].remove("click",t)}),n.eventIds[e]=[]})},o);function o(t){this.context=t,this.listeners={},this.eventIds={}}n.default=t},{"../core/units/direction":7,"./listener":14}],16:[function(t,e,n){"use strict";n.__esModule=!0;var o=(i.prototype.render=function(t,e){var n,o,i;this.context&&(o=(n=e.count).x,i=n.y,e=n.w,n.h,this.context.font="20px Georgia",this.context.fillStyle="#000",this.context.fillText("步数："+t.count,o+20,i-20,e))},i);function i(t){this.context=t}n.default=o},{}],17:[function(t,e,n){"use strict";n.__esModule=!0;var o=(c.getColor=function(t){return c.colorMap[t]||(c.colorMap[t]=c.colorPalette[c.colorId++]),c.colorMap[t]},c.prototype.render=function(t,e){var n,o,i,r,s;this.context&&(n=(s=e.panel).x,o=s.y,i=e.cellSize,r=e.coordinate,s=e.alias,e=e.locked,this.context.fillStyle=c.getColor(s),this.context.strokeStyle=c.getColor(s),this.context.beginPath(),this.context.arc(n+r.x*i+i/2,o+r.y*i+i/2,i/3,0,2*Math.PI),e?this.context.stroke():this.context.fill())},c.colorPalette=["#d60380","#2a5ac7","#f3e100"],c.colorId=0,c.colorMap={},c);function c(t){this.context=t}n.default=o},{}],18:[function(t,e,n){"use strict";n.__esModule=!0;var h=t("../core/units/obstacle"),t=(o.prototype.render=function(t,e){if(this.context){var n=t.cells,t=e.panel,o=t.x,i=t.y,e=t.w,t=t.h;this.context.fillStyle="#eee",this.context.fillRect(o,i,e,t);for(var r=e/Math.sqrt(n.length),s=0;s<n.length;s++){var c=n[s],l=c.obstacle,a=c.coordinate.get(),c=a.x,a=a.y,u="#fff";switch(l.type){case h.EObstacleType.Null:u="#fff";break;case h.EObstacleType.Stake:u="#242e3510";break;case h.EObstacleType.Freeze:u="#cceff1";break;default:u="#fff"}this.context.fillStyle=u,this.context.fillRect(o+c*r+1,i+a*r+1,r-1,r-1)}return r}},o);function o(t){this.context=t}n.default=t},{"../core/units/obstacle":9}],19:[function(t,e,n){"use strict";n.__esModule=!0;var o=(i.prototype.render=function(t,e){var n,o,i;this.context&&(n=t.count,o=(i=e.board).x,t=i.y,e=i.w,i=i.h,this.context.fillStyle="#00000080",this.context.fillRect(o,t,e,i),this.context.fillStyle="#000",this.context.font="24px Georgia",this.context.fillStyle="#000",this.context.textAlign="center",this.context.fillText("Congratulations!!!",e/2,i/2-20,e),this.context.fillText("Your score is",e/2,i/2+20,e),this.context.font="64px Georgia",this.context.fillStyle="#f00",this.context.fillText(""+n,e/2,i/2+80,e))},i);function i(t){this.context=t}n.default=o},{}],20:[function(t,e,n){"use strict";n.__esModule=!0;var o=(i.prototype.render=function(t,e){var n,o,i;this.context&&(o=(n=e.time).x,i=n.y,e=n.w,n.h,this.context.font="20px Georgia",this.context.fillStyle="#000",this.context.fillText("耗时："+t.time,o+20,i-20,e))},i);function i(t){this.context=t}n.default=o},{}],21:[function(t,e,n){"use strict";var c=this&&this.__assign||function(){return(c=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};n.__esModule=!0;var l=t("./render_panel"),a=t("./render_mover"),o=t("./render_controller"),u=t("./render_time"),h=t("./render_count"),f=t("./render_success"),t=(i.prototype.calcLayout=function(){if(this.canvas&&this.container&&this.context)return this.canvas.width=this.container.clientWidth,this.canvas.height=this.container.clientHeight,this.context.canvas.width>this.context.canvas.height?this.horizontalLayout():this.verticalLayout()},i.prototype.horizontalLayout=function(){var t=this.canvas.height,e=[t/2*3|0,t],n=e[0],o=e[1],e=(this.canvas.width-n)/2|0;return{board:{x:e,y:0,w:n,h:o},panel:{x:e,y:0,w:t,h:t},time:{x:e+n,y:0,w:e,h:o/2},count:{x:e+n,y:0,w:e,h:o/2},controller:{x:e+o,y:o/2,w:o/2,h:o/2}}},i.prototype.verticalLayout=function(){var t=this.canvas.width,e=[t,t/2*3|0],n=e[0],t=e[1],e=(this.canvas.height-t)/2|0;return{board:{x:0,y:e,w:n,h:t},panel:{x:0,y:e,w:n,h:n},time:{x:0,y:2*e+n,w:n/2,h:e},count:{x:0,y:3*e+n,w:n/2,h:e},controller:{x:n/2,y:e+n,w:n/2,h:n/2}}},i.prototype.render=function(t){if(this.canvas&&this.container&&this.context){var e=this.calcLayout();if(e){this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.context.fillStyle="#ddd",this.context.fillRect(0,0,this.canvas.width,this.canvas.height);var n=e.board;this.context.fillStyle="#eee",this.context.fillRect(n.x,n.y,n.w,n.h);var o=new l.default(this.context).render(t,e);new u.default(this.context).render(t,e),new h.default(this.context).render(t,e),null!==(n=this.controller)&&void 0!==n&&n.render(t,e);for(var i=t.movers,r=t.lockedMovers,s=0;s<i.length;s++)new a.default(this.context).render(t,c(c(c({},e),{cellSize:o}),i[s]));for(s=0;s<r.length;s++)new a.default(this.context).render(t,c(c(c({},e),{cellSize:o}),r[s]));t.isSuccess&&new f.default(this.context).render(t,e)}}},i);function i(t){if(this.controller=null,this.containerId=t,this.container=document.getElementById(t),!this.container)throw new Error("Cannot find element by id "+this.containerId+".");this.canvas=document.createElement("canvas"),this.canvas.width=this.container.clientWidth,this.canvas.height=this.container.clientHeight,this.context=this.canvas.getContext("2d"),this.container.appendChild(this.canvas),this.controller=new o.default(this.context)}n.default=t},{"./render_controller":15,"./render_count":16,"./render_mover":17,"./render_panel":18,"./render_success":19,"./render_time":20}]},{},[13]);